---
title: "Pipeline Masterarbeit"
author: "Steffen Ernst"
date: "2023-03-20"
output:
  html_document: default
  pdf_document: default
---



Hey ihr 2, hier mal eine quick-and-dirty Analyse aller 4 Datensätze. 
Ich hoffe das Format ist so in Ordnung.

Zu beachten:

Schwierigkeit 3 ist die höchste, 1 die niedrigste. (wird umgepolt)

correct bezieht sich nur auf die richtige Entscheidung und nicht darauf, ob Punkte erzielt wurden.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE) 

if (!require("pacman")) install.packages("pacman"); library(pacman)
p_load(tidyverse, janitor, lme4, apaTables, lmerTest, RColorBrewer, patchwork, knitr, forcats)
setwd("C:/Users/steff/Documents/Universität/Master Psychologie/SS 2022/Masterarbeit/Experiment/Daten/Daten_cleaned")
df <- list.files(pattern = "*.csv") %>% 
    map_df(~read_csv(.))
options(dplyr.summarise.inform = FALSE)

```

```{r Vorbereitung}
#Vorverarbeitung
#Abtrennen von Tutorialbereich


levels(df$difficulty_f) <-
  c("sehr schwer", "eher schwer", "eher leicht", "sehr leicht")
levels(df$geschlecht) <- c("männlich", "weiblich")

df_tut <- df %>%
  filter(tutorial == 1)
df <- df %>%
  filter(tutorial == 0)
#sachen die ich nachschauen möchte
#blau vs orange
```


```{r Geldausschüttung}
# ohne Pretest
df %>% 
  filter(subject_nr > 4) %>%#nur Leute nach dem Pretest
  group_by(code) %>% 
  summarise(Punkte = max(punkte1)) %>% 
  arrange(desc(Punkte)) %>% 
  head(n=3)
#1. kal1996he 2520
#2. ta1999ma  2340
#3. an1999ma  2264

#mit Pretest
df %>% 
 # filter(subject_nr > 4) %>%#nur Leute nach dem Pretest
  group_by(code) %>% 
  summarise(Punkte = max(punkte1)) %>% 
  arrange(desc(Punkte)) %>% 
  head(n=3)
  
#3. ka2000mo  2280 (ausm Pretest)
```

Hier Infos zur Demographie.
Zur Händigkeit: 3 ist rechtshänder, 1 ist linkshänder. In der Tabelle ist der Mean aus 4 Fragen.

```{r Demogreaphievariablen}
demographie <- df %>% 
  group_by(code) %>% 
  summarise(
    Alter=unique(alter),
    Gender= ifelse(unique((geschlecht))==1,"weiblich", "männlich"),
    Studiengang=unique(studiengang),
    Bildungsabschluss=if_else(unique(bildungsabschluss) == 5, "Abitur oder Fachhochschulreife", "Hochschulabschluss"),
    Händigkeit = unique(haendig_mean)
    )
kable(demographie, format = "markdown", digits = 2, align = "c")

```
Hier sind checks, ob die einzelnen Schwierigkeiten und Farben richtig balanciert sind. Sieht alles gut aus.
```{r Checks balancing, warning=FALSE}
table(df$correct_colour)
#blau vs orange pro Schwierigkeit
df %>% 
  group_by(difficulty,block) %>% 
  summarise(blau = sum(str_count(correct_colour,"b")),orange = sum(str_count(correct_colour,"o")))

#Schwierigkeit pro Bedingung
df %>% 
  group_by(block) %>% 
  summarise(s0 =sum(difficulty==0),s1 = sum(difficulty==1),s3 = sum(difficulty==2),s4 = sum(difficulty==3))



ggplot(data = df, aes(x=block, y = response_time)) +
  geom_jitter() +
  geom_hline(yintercept = 700)
```


Hier mal die RTs aufgesplittet nach Person in der Speedbedingung:
```{r}
list_rts_speed <- list()
j = 1  
for (i in levels(df$difficulty_f)) {

  list_rts_speed[[j]] <- df %>% 
  filter(difficulty_f == i, block == "speed") %>% 
  ggplot(aes(x = code, y=response_time )) +
  geom_boxplot(show.legend = F) +
  theme_minimal() + 
  ggtitle(i) +
 # theme(axis.text.y = element_blank()) + 
  xlab("") +
  geom_hline(yintercept = unique(df$cutoff)) + 
  theme(axis.title.x = element_blank(),
        axis.text.x =  element_blank(),   
        axis.ticks.x = element_blank()) 
  
  j = j+1
} 
(list_rts_speed[[1]] + list_rts_speed[[2]] +  list_rts_speed[[3]] + list_rts_speed[[4]]) + plot_annotation(
  title = "RTs in Speedbedingung") #subtitle = "rot = falsch, blau = richtig")


```
Und hier für die Genauigkeitsbedingung:
```{r}
list_rts_acc <- list()
j = 1  
for (i in levels(df$difficulty_f)) {

  list_rts_acc[[j]] <- df %>% 
  filter(difficulty_f == i, block == "accuracy") %>% 
  ggplot(aes(x = code, y=response_time )) +
  geom_boxplot(show.legend = F) +
  scale_color_brewer(palette = "Reds") + 
  theme_minimal() + 
  ggtitle(i) +
 # theme(axis.text.y = element_blank()) + 
  xlab("") +
  theme(axis.title.x = element_blank(),
        axis.text.x =  element_blank(),   
        axis.ticks.x = element_blank())
  
  j = j+1
} 
(list_rts_acc[[1]] + list_rts_acc[[2]] +  list_rts_acc[[3]] + list_rts_acc[[4]]) + plot_annotation(
  title = "RTs in Genauigkeitsbedingung")
```

Hier die RTs in der Speedbedingung pro Person:

```{r}
list_rts_pers_speed <- list()
j = 1  
for (i in unique(df$code)) {

  list_rts_pers_speed[[j]] <- df %>% 
  filter(code == i, block == "speed") %>% 
  ggplot(aes(x=difficulty, y = response_time, colour = as.factor(difficulty))) +
  geom_boxplot(show.legend = F) +
  scale_color_brewer(palette = "Reds") + 
  theme_classic() +
  labs(colour = "Schwieirgkeit") +
  ggtitle(i) +
 # theme(axis.text.y = element_blank()) + 
  xlab("") +
  ylab("")
  j = j+1
} 
patchwork::wrap_plots(list_rts_pers_speed, title = "RTs in SPeedbedingung")
 
```

und hier in der Genauigkeitsbedingung:

```{r}
list_rts_pers_acc <- list()
j = 1  
for (i in unique(df$code)) {

  list_rts_pers_acc[[j]] <- df %>% 
  filter(code == i, block == "accuracy") %>% 
  ggplot(aes(x=difficulty, y = response_time, colour = as.factor(difficulty))) +
  geom_boxplot(show.legend = F) +
  scale_color_brewer(palette = "Reds") + 
  theme_classic() +
  labs(colour = "Schwieirgkeit") +
  ggtitle(i) +
 # theme(axis.text.y = element_blank()) + 
  xlab("") +
  ylab("")
  j = j+1
} 
patchwork::wrap_plots(list_rts_pers_acc,  title = "RTs in Genauigkeitsbedingung")
```


Hier die richtig vs. falschen Accuracywerte als Graph:

```{r}
results_block <- df %>% 
  count(difficulty_f, block, code, correct) %>% 
 # mutate(difficulty_f = fct_relevel(difficulty_f, rev(levels(difficulty_f)))) %>% 
  group_by(difficulty_f, block, code) %>% 
  mutate(Anteil_korrekt = n / 96) %>% 
  arrange(block) %>%   
  filter(correct == 1) %>% 
  select(-n,-correct)

results_block$difficulty_f <- factor(
  results_block$difficulty_f,
  levels = c("sehr leicht", "eher leicht", "eher schwer", "sehr schwer")
)

j=1
list_results_all = list()
for (i in unique(df$block)) {
  list_results_all[[j]] <- results_block %>% 
  filter(block == i) %>% 
  arrange(Anteil_korrekt) %>%    # First sort by val. This sort the dataframe but NOT the factor levels
  #mutate(difficulty_f=factor(difficulty_f, levels=difficulty_f)) %>%  
    #mutate(dificulty_f = fct_relevel(difficulty_f, "sehr schwer", "eher schwer", "eher leicht", "sehr leicht")) %>% 
  ggplot(aes(x=difficulty_f, y = Anteil_korrekt)) +
  geom_point(show.legend = F)+
    scale_color_brewer(palette = "Reds") + 
  theme_classic() +
  ggtitle(i) +
 # theme(axis.text.y = element_blank()) + 
  xlab("")
  j = j+1
}
patchwork::wrap_plots(list_results_all)
```



eine Tabelle pro Person, pro Schwierigkeit und Phase als Tabelle:
```{r}
results_acc_tabelle <- results_block %>% 
    #filter(block == "accuracy") %>% 
    pivot_wider(names_from = code, values_from = c(Anteil_korrekt)) %>% 
    rename(difficulty = difficulty_f) %>% 
    mutate(difficulty = factor(difficulty, levels = c("sehr leicht", "eher leicht", "eher schwer", "sehr schwer"))) %>% 
    arrange(block,difficulty)

#colnames(results_acc_tabelle) <- c("difficulty", lapply(unique(df$code), function(x) paste0("speed_", x)),lapply(unique(df$code), function(x) paste0("acc_", x)) )
  
 # c("difficulty", "acc_an2000he", "acc_ga1999ma", "acc_ka2000mo", "acc_li1999no", "speed_an2000he", "speed_ga1999ma", "speed_ka2000mo", "speed_li1999no")


kable(results_acc_tabelle, format = "markdown", digits = 2, align = "c")


```




!!! Die nachfolgenden Plots gehen über ALLE Datenpunkte hinweg, da weiß ich nicht ob die so sinnvoll sind. !!!
DIe einzelnen Plots finden sich in den Reports subject 1-4.


Hier habe ich wieder grob die richtigen vs. falschen RTs geplottet insgesamt und auf die Bedingungen aufgeteilt geplottet. 
Kennt ihr da eine bessere Alternative als Density Plots? 
```{r rt distributions by wrong or right}
df %>% 
  ggplot(aes(x=response_time, colour = correct)) +
  geom_density() + 
  theme_minimal() + 
  ggtitle("RTs über beide Bedingungen")+
  ylab("") + 
  xlim(0,3000) +
  xlab("")

df %>% 
  filter(block == "speed") %>% 
  ggplot(aes(x=response_time, colour = correct)) +
  geom_density() + 
  theme_minimal() + 
  ggtitle("RTs in der Geschwindigkeitsbedingung")+
  ylab("") + 
  xlim(0,max(df[df$block == "speed",]$response_time)) +
  xlab("")

df %>% 
  filter(block == "accuracy") %>% 
  ggplot(aes(x=response_time, colour = correct)) +
  geom_density() + 
  theme_minimal() + 
  ggtitle("RTs in der Genauigkeitsbedingung")+
  ylab("") + 
  xlim(0,3000) +
  xlab("")
```

Hier die RTs je nach Schwierigkeit in der Speedbedingung:
```{r}
list_speed <- list()
j = 1
for (i in levels(df$difficulty_f)) {
  list_speed[[j]] <- df %>% 
   filter(block == "speed", difficulty_f == i) %>% 
  ggplot(aes(x=response_time, colour = correct)) +
  geom_density(adjust = 1.1) + 
  theme_minimal() + 
  ggtitle(i) +
 # theme(axis.text.y = element_blank()) + 
  ylab("") + 
  xlim(0,3000) +
  xlab("")
  
  j = j+1
} 
(list_speed[[1]] + list_speed[[2]] +  list_speed[[3]] + list_speed[[4]]) + plot_annotation(
  title = "RTs in Speedbedingung") #subtitle = "rot = falsch, blau = richtig")
```
Das waren erstmal meine Ideen :) 
Wenn ihr das noch anders aufbereitet sehen wollt, schreibt es mir gerne!


Hier die RTs je nach Schwierigkeit in der Genauigkeitsbedingung:

```{r}
list_acc <- list()
j = 1
for (i in levels(df$difficulty_f)) {
  list_acc[[j]] <- df %>% 
   filter(block == "accuracy", difficulty_f == i) %>% 
  ggplot(aes(x=response_time, colour = correct)) +
  geom_density(adjust = 1.1) + 
  theme_minimal() + 
  ggtitle(i) +
 # theme(axis.text.y = element_blank()) + 
  ylab("") + 
  xlim(0,3000) +
  xlab("")
  
  j = j+1
} 
(list_acc[[1]] + list_acc[[2]] +  list_acc[[3]] + list_acc[[4]]) + plot_annotation(
  title = "RTs in Genauigkeitsbedingung") #subtitle = "rot = falsch, blau = richtig")



```
Hier noch ein neuer Plot für die Farben-Präferenz
```{r}
df %>% 
  ggplot(aes(x=response_time, colour = correct_colour)) + 
  geom_density()


```


Hier sind noch mehr weniger nützliche Plots:
```{r}
df_arranged <- df %>% 
  group_by(block) %>% 
  arrange(., desc(response_time))

df_arranged %>% 
filter(block == "speed") %>% 
      ggplot(., aes(x=1:nrow(.), y=response_time, colour = difficulty_f)) +
  geom_point(alpha = .3) + #,subset(df_arranged,block != "accuracy")) + 
  scale_color_brewer(palette = "Reds") + 
  theme_minimal()

df_arranged %>% 
filter(block == "accuracy") %>% 
      ggplot(., aes(x=1:nrow(.), y=response_time, colour = correct)) +
  geom_point(alpha = .3) + #,subset(df_arranged,block != "accuracy")) + 
  theme_minimal()

```

